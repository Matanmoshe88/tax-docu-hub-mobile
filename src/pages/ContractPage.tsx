import React, { useState, useEffect } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { PortalLayout } from '@/components/PortalLayout';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { FileText, User, Calendar } from 'lucide-react';

interface ClientData {
  firstName: string;
  lastName: string;
  idNumber: string;
  phone: string;
  email: string;
  address: string;
  commissionRate: string;
}

export const ContractPage: React.FC = () => {
  const navigate = useNavigate();
  const { leadId } = useParams();
  const [clientData, setClientData] = useState<ClientData>({
    firstName: "יוסי",
    lastName: "כהן", 
    idNumber: "123456789",
    phone: "050-1234567",
    email: "yossi.cohen@email.com",
    address: "רחוב הרצל 1, תל אביב",
    commissionRate: "25%"
  });

  useEffect(() => {
    // TODO: Fetch client data from Salesforce based on leadId
    console.log('Loading client data for lead:', leadId);
  }, [leadId]);

  const handleNext = () => {
    navigate(`/signature/${leadId}`);
  };

  const handlePrevious = () => {
    navigate('/');
  };

  const contractText = `בין: קוויק טקס (שם רשום: "ג'י.אי.אמ גלובל") ח"פ: 513218453 (להלן: "קוויקטקס" ו/או "החברה")
לבין: ${clientData.firstName} ${clientData.lastName} ת"ז: ${clientData.idNumber} (להלן: "הלקוח")
שנחתם בתאריך: ${new Date().toLocaleDateString('he-IL')}

הואיל והלקוח מאשר בזאת כי הינו מבקש לבדוק את זכאותו להחזרי מס באמצעות ג'י.אי.אמ גלובל ניהול והשקעות בע"מ ח.פ. 513218453 להלן: ("קוויקטקס" ו/או "החברה") שכתובתה ת.ד. 11067, פתח-תקווה מיקוד 4934829 מול כלל הרשויות לרבות מס הכנסה וביטוח לאומי לצורך ייצוגו וטיפולו בקבלת ההחזר ממס הכנסה (להלן: "החזר המס") לשנים 2023-2018 (להלן: "תקופת המס") ולבצע עבורו את הפעולות הנדרשות על מנת לקבל החזר מס במקרה של זכאות;

והואיל והחברה - המעסיקה רו"ח ויועצי מס ועוסקת במתן שירותים אל מול רשויות המס לשם ביצוע החזרי מס לשכירים והגשת דוחות כספיים- מסכימה ליטול על עצמה את ייצוגו של הלקוח בהליך החזר המס;

לפיכך, הוצהר, הוסכם והותנה בין הצדדים כדלקמן:

1. החברה מספקת שירות לטיפול בהחזרי מס לשכירים מרשויות המס השונות, תוך ליווי הלקוח והגשת בקשות להחזר מיסים בשמו. תנאי סף לבדיקת הזכאות הוא שהלקוח היה שכיר ושילם מס הכנסה בשש השנים האחרונות, והלקוח מצהיר כי עומד בתנאי הסף כאמור לעיל. הטיפול של החברה כולל הזמנת המסמכים הרלוונטיים מרשויות המס בשם הלקוח, בחינתם על ידי אנשי מקצוע (רואי חשבון ו/או יועצי מס) ובמידה ונתוני הלקוח עונים על התנאים להחזר, תוגש בשמו של הלקוח בקשה להחזר מס (להלן: "השירות").

2. השירות הניתן הוא לטיפול בהחזר מס בלבד (לצורך הסכם זה, המונח "החזר מס" יהיה הסכום שייקבע על פי שומת מס הכנסה לתקופה הרלוונטית, לפני כל קיזוז ו/או עיקול בגין חוב המגיע ממנו לצד ג') ואינו כולל כל עניין ו/או טיפול אחרים מלבד כמפורט במפורש לעיל ולהלן. כל שירות שאינו חלק מתהליך קבלת החזרי המס כגון תיאום מס, סגירת תיקים פתוחים במס הכנסה וכד' יהיה כרוך בתשלום נוסף על פי תעריפי החברה ובהתאם לשיקול דעתה הבלעדי של החברה.

3. הלקוח מאשר בזאת לחברה לטפל עבורו בהחזרי המס לשנים 2026-2017 (להלן: "תקופת המס") ולשם כך לבצע עבור הלקוח את הפעולות הנדרשות על מנת לקבל החזרי מס ולטפל בכל הנוגע בדבר, לרבות בדיקת זכאותו להחזרי מס ומייפה את כוחה של החברה ו/או רואה חשבון מטעמה ו/או מי מטעמה לפנות בשמו ובמקומו לרשויות המס או לגופים הרלוונטיים אחרים, לרבות מס הכנסה וביטוח לאומי, וזאת על מנת לבקש, לאסוף או להגיש את המסמכים הדרושים או על מנת שיוכל לפעול בכל דרך אחרת הנדרשת לבדיקת זכאות הלקוח להחזרי מס לטובת טיפול בקבלת החזר, וזאת ללא צורך בעדכון הלקוח או קבלת אישור הלקוח לגבי כל השנים המצוינות בתקופת המס.

4. כמו כן, ידוע ללקוח כי לצורך טיפול יעיל ומהיר הוא יידרש לחתום על מסמכים לרבות בקשה לרישום ייצוג ו/או מתן ייפוי הכוח המאפשר לחברה ו/או מי מטעמה להציג ולהגיש כל מסמך ומידע השייך ללקוח לביטוח לאומי ו/או לרשויות המס, המצ"ב להסכם זה (ראה מצ"ב יפוי כח כנספח א'), לטובת ביצוע בדיקת הזכאות וטיפול בהחזר המס, והלקוח מאשר לחברה ו/או מי מטעמה לקבל עבורו את כל הנתונים והמסמכים הרלוונטיים הנדרשים לצורך הטיפול בהחזר המס, ומתחייב לשתף פעולה להשגת כלל המסמכים והנתונים הנדרשים לצורך בדיקת זכאות הלקוח להחזר מס והגשת הדו"ח.

5. אין בבדיקותיה ושירותיה של החברה להבטיח החזרת מס בפועל. כמו כן, לחברה לא תהיה כל אחריות כלפי הלקוח, במישרין ו/או בעקיפין, בכל תוצאת הבדיקה ו/או החלטה ו/או נימוק ו/או כל דרישה שהיא, בעבר, הווה ובעתיד, של רשויות המס והמוסד לביטוח לאומי מהלקוח, לרבות חבות מס ו/או שינויים בתקנות ובנהלים של רשויות המס שיש בהם כדי להשפיע על אי קבלת ההחזר, סכום ההחזר ו/או מועד קבלתו ו/או במקרה של דחיית הבקשה, באופן מלא או חלקי, או גובה ההחזר, מכל סיבה שהיא. למען הסר ספק, החברה לא מתחייבת כי הלקוח יקבל החזר מס בפועל וללקוח לא תהא כל טענה ו/או דרישה ו/או תביעה נגד החברה בקשר להחלטת הרשויות.

6. הלקוח מצהיר ומתחייב שלא לטפל בהחזרי המס בתקופת המס שבטיפול בכל דרך אחרת, לרבות בדו"ח פרטי, כמו כן מתחייב הלקוח להעביר לחברה כל מסמך ו/או אסמכתא ו/או מידע הנחוצים לטובת הייצוג ללא דיחוי. הלקוח מתחייב לאשר את הייצוג באזור האישי במס הכנסה ולשתף פעולה. הלקוח מתחייב לפעול בשקיפות מלאה עם החברה ולהעביר מידע נכון ומלא לרבות לעניין הדיווחים לרשויות המס או לגורמים אחרים ולרבות כלל הנתונים הרלוונטיים אודותיו ואודות משפחתו באופן מלא, אמיתי ומדויק ומצהיר כי ידוע לו שהחברה מתקשרת אתו על בסיס הנתונים כאמור. הלקוח מצהיר כי מסר לחברה את כל המסמכים, הנתונים והפרטים שהיו בידיו ובידיעתו כי פרט להכנסות עליהן דיווח, לא היו לו או לבת/בן זוגו/ה הכנסות נוספות בארץ או ובחו"ל, מכל מקור שהוא, בין אם ממשלח יד ובין אם ממקור אחר.

7. הלקוח מצהיר ומודע לכך כי אי שיתוף פעולה מצד הלקוח ואי מסירת המידע או מסירת מידע שאינו נכון ו/או עדכני ו/או מלא עלול לעכב את מתן השירות או לגרום לסירוב הבקשה וללקוח לא יהיה בגין עיכוב ו/או סירוב כאמור כל טענה ו/או דרישה ו/או תביעה כנגד החברה. יובהר כי החברה תגיש את הבקשה להחזר מס על סמך מידע שהתקבל מאת הלקוח כמו שהוא וכי לחברה אין אחריות ישירה ו/או שילוחית לנכונותו, כמו כן לחברה לא תהיה כל אחריות כלפי הלקוח, במישרין ו/או בעקיפין, בכל דרישה שהיא, בעבר, הווה ובעתיד, של רשויות המס והמוסד לביטוח לאומי מהלקוח, לרבות חבות מס ו/או שינויים בתקנות שיכולים להשפיע על אי קבלת ההחזר, סכום ההחזר ו/או מועד קבלתו.

8. בעת מסירת פרטים אישיים, בהזמנת שירות או מוצר, מאשר הלקוח לחברה לפנות אליו בכל אמצעי תקשורת שתראה לנכון, בהצעות ומידע שיווקי ופרסומי (לרבות על פי סעיף 30א' לחוק התקשורת) הקשור לשירותי החברה ולמוצרים המשווקים באמצעותה. אם אין הלקוח מעוניין בפניות החברה בכלל או באמצעות אמצעי תקשורת ספציפי בפרט, עליו להודיע על כך לחברה באחת מדרכי התקשורת המפורטות באתר החברה.

9. ככל שהדבר נדרש לפי דין, המידע האישי שמסר הלקוח לחברה, ככל שמסר, ישמר במאגר המידע של החברה (להלן: "מאגר המידע"). בעת מסירת המידע האישי לחברה, הלקוח מתחייב כי הפרטים שמסר הנם פרטים נכונים, מלאים ולא שגויים או מסולפים. הלקוח מצהיר כי ידוע לו כי במהלך פנייה אל מוקד השירות של החברה ייתכן כי שיחתו עם מוקד השירות תוקלט לטובת בקרה ושיפור השירות. ידוע ללקוח והוא מסכים כי החברה תשתמש במידע האישי לכל מטרה שהיא בהתאם להוראות כל דין. כך, למשל, רשאית החברה לעשות שימוש במידע האישי לצורך אספקת השירותים, ולצורך שינוי ושיפור התכנים והשירותים, הענקת שירותי תמיכה ויצירת מידע סטטיסטי. כמו כן, החברה רשאית לעשות שימוש במידע האישי בכפוף לכל דין על מנת לשלוח ללקוח מדי פעם ניוזלטרים ו/או הודעות ובהם עדכונים על מבצעים שונים, חידושים בשירותים הניתנים ו/או במוצרים המוצעים, הודעות ו/או פרסומות שונות (מטעם החברה ו/או מטעם צדדים שלישיים) שהחברה ו/או מי מטעמה חושבת שהלקוח עשוי למצוא בהם עניין (להלן: "דברי פרסומת").

10. מוסכם כי המידע עשוי להימסר לגופים על פי דין או צו בית המשפט, בין אם מכוח רגולציה לטובת ניהול הליכים משפטיים ודומיהם, שותפים עסקיים, קיימים או פוטנציאליים, בכפוף ובהתאם לחוק ובכפוף לקיום התחייבותו של הצד האמור לשמירה על סודיות המידע. מבלי לגרוע מהאמור לעיל, במתן המידע מסכים הלקוח כי המידע יימסר לצורך עיבודו ואחסונו לכל צד שעיסוקו בכך, וזאת בכפוף להוראות חוק הגנת הפרטיות, התשמ"א-1981 בלבד.

18. תנאי תשלום: הלקוח מתחייב לשלם לחברה עמלה בגובה של ${clientData.commissionRate} מסכום ההחזר בתוספת מע"מ (להלן: "עמלה") וזאת רק לאחר קבלת הכסף לחשבון הבנק של הלקוח. סכום העמלה כאמור ישולמו עד ארבעה (4) ימי עסקים מרגע קבלת החזר המס בפועל בחשבונו האישי של הלקוח או בן/בת זוגו. העמלות כאמור ישולמו על-ידי הלקוח לחשבון בנק על שם החברה (ג'י.אי.אמ גלובל ניהול והשקעות בע"מ) בבנק: 20-מזרחי-טפחות, סניף: 481, חשבון: 347847, או באמצעות כרטיס אשראי, בהתאם לשיקול דעתה הבלעדי החברה. ככל והלקוח לא יהיה ימצא זכאי להחזר לא ידרש לשלם עמלה כאמור בסעיף זה.

19. אם העמלה לא תשולם במועדה כמצוין בסעיף 18 לעיל אזי ישלם המזמין לחברה סך של 50 ₪ עבור כל יום עיכוב בתשלום, ולא תהיה ללקוח כל טענה בקשר לכך.

20. כמו כן, ידוע ללקוח כי איחור בתשלום מעבר ל-14 ימים מיום קבלת החזר המס ללקוח יגרור התערבות המשפטית הכרוכה בהוצאות משפטיות בעלות של 1,500 ₪ בתוספת מע"מ כדין אשר יתווספו לחוב הלקוח.

21. בכל מקרה שהלקוח יפגר בביצוע תשלום העמלה כמפורט לעיל מעבר ל-14 ימים, מתחייב הלקוח לשלם לחברה בנוסף לתשלום הפרשי ההצמדה, ריבית פיגורים בשיעור הנהוג אצל בנק מזרחי-טפחות בע״מ בחשבונות חח״ד (להלן: ״ריבית הפיגורים״), החל מהיום הראשון לפיגור.

עד כאן תוכן ההסכם המשפטי לטיפול בהחזרי מס לצרכנים פרטיים.`;

  return (
    <PortalLayout
      currentStep={1}
      totalSteps={4}
      onNext={handleNext}
      onPrevious={handlePrevious}
      nextLabel="אני מסכים להמשך"
      previousLabel="חזור לעמוד הבית"
    >
      <div className="space-y-6 animate-fade-in">
        {/* Header */}
        <div className="text-center space-y-4">
          <div className="flex justify-center">
            <div className="bg-primary/10 p-4 rounded-full">
              <FileText className="h-8 w-8 text-primary" />
            </div>
          </div>
          <h1 className="text-3xl font-bold text-foreground">הסכם שירות</h1>
          <p className="text-muted-foreground max-w-2xl mx-auto">
            אנא קרא את הסכם השירות בעיון לפני המעבר לשלב הבא. החוזה מפרט את התנאים והזכויות שלך.
          </p>
        </div>


        {/* Contract Content */}
        <div className="w-full max-w-none mx-0">
          <Card className="shadow-card mx-0 max-w-none">
            <CardHeader>
              <CardTitle>תוכן ההסכם</CardTitle>
            </CardHeader>
            <CardContent className="p-2 sm:p-6">
              <div className="max-w-none text-right leading-relaxed">
                <pre className="text-xs sm:text-sm leading-6 sm:leading-7 whitespace-pre-wrap font-hebrew text-right bg-muted/20 p-3 sm:p-6 rounded-lg border w-full overflow-x-auto">
                  {contractText}
                </pre>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Important Notice */}
        <Card className="border-warning shadow-card">
          <CardContent className="pt-6">
            <div className="flex items-start gap-3">
              <div className="bg-warning/10 p-2 rounded-full mt-1">
                <FileText className="h-4 w-4 text-warning" />
              </div>
              <div className="space-y-2">
                <h3 className="font-semibold text-warning">שים לב</h3>
                <p className="text-sm text-muted-foreground">
                  על ידי לחיצה על "אני מסכים להמשך" אתה מאשר שקראת והבנת את תנאי ההסכם ומסכים לכל התנאים המפורטים בו.
                </p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </PortalLayout>
  );
};